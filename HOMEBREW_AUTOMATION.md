# Homebrew Automation Setup

This guide explains how to set up automated Homebrew formula updates when you release a new version of Venaqui.

## Prerequisites

1. ✅ Created `mhrsntrk/homebrew-venaqui` repository
2. ✅ GoReleaser configuration updated (already done)
3. ⏳ GitHub token setup (see below)

## Step 1: Create GitHub Personal Access Token

You need a GitHub Personal Access Token (PAT) with permissions to write to the `homebrew-venaqui` repository.

### Create Token

1. Go to https://github.com/settings/tokens
2. Click "Generate new token" → "Generate new token (classic)"
3. Give it a name: `Homebrew Venaqui Automation`
4. Set expiration (recommended: 90 days or custom)
5. Select scopes:
   - ✅ `repo` (Full control of private repositories)
     - This includes: `repo:status`, `repo_deployment`, `public_repo`, `repo:invite`, `security_events`
6. Click "Generate token"
7. **Copy the token immediately** (you won't see it again!)

### Alternative: Fine-grained Token (Recommended)

For better security, use a fine-grained token:

1. Go to https://github.com/settings/tokens?type=beta
2. Click "Generate new token"
3. Name: `Homebrew Venaqui Automation`
4. Expiration: Set as needed
5. Repository access: Select `Only select repositories`
   - Select: `mhrsntrk/homebrew-venaqui`
6. Repository permissions:
   - Contents: Read and write
   - Metadata: Read-only
7. Click "Generate token"
8. Copy the token

## Step 2: Add Token to GitHub Secrets

1. Go to your main repository: https://github.com/mhrsntrk/venaqui
2. Navigate to: **Settings** → **Secrets and variables** → **Actions**
3. Click **"New repository secret"**
4. Name: `HOMEBREW_GITHUB_API_TOKEN`
5. Value: Paste your token
6. Click **"Add secret"**

## Step 3: Initialize Homebrew Tap Repository

The first time, you need to create the initial formula file structure:

1. Go to https://github.com/mhrsntrk/homebrew-venaqui
2. Create a `Formula` directory (if it doesn't exist)
3. Create `Formula/venaqui.rb` with this content:

```ruby
# This file will be auto-generated by GoReleaser on first release
# You can create it manually or let GoReleaser create it
```

Or simply create an empty file - GoReleaser will populate it on the first release.

Alternatively, you can create the initial formula manually:

```ruby
class Venaqui < Formula
  desc "CLI tool with TUI for downloading files via Real-Debrid and aria2"
  homepage "https://github.com/mhrsntrk/venaqui"
  url "https://github.com/mhrsntrk/venaqui/archive/v0.1.0.tar.gz"
  sha256 "PLACEHOLDER_SHA256"
  license "MIT"
  head "https://github.com/mhrsntrk/venaqui.git", branch: "main"

  depends_on "go" => :build
  depends_on "aria2"

  def install
    system "go", "build", "-o", bin/"venaqui", "./cmd/venaqui"
  end

  test do
    system "#{bin}/venaqui", "version"
  end
end
```

**Note:** GoReleaser will automatically update this file on each release, so you don't need to maintain it manually.

## Step 4: Test the Automation

1. Make sure your changes are committed:
   ```bash
   git add .goreleaser.yml .github/workflows/release.yml
   git commit -m "Enable Homebrew automation"
   git push origin main
   ```

2. Create a new release tag:
   ```bash
   git tag -a v0.1.5 -m "Release v0.1.5"
   git push origin v0.1.5
   ```

3. Watch the GitHub Actions workflow:
   - Go to: https://github.com/mhrsntrk/venaqui/actions
   - The release workflow should run automatically
   - Check that it completes successfully

4. Verify the Homebrew formula was updated:
   - Go to: https://github.com/mhrsntrk/homebrew-venaqui
   - Check `Formula/venaqui.rb` - it should be updated with the new version

## How It Works

1. **You create a release tag** (e.g., `v0.1.5`)
2. **GitHub Actions triggers** the release workflow
3. **GoReleaser builds** binaries for all platforms
4. **GoReleaser generates** the Homebrew formula with:
   - Updated version number
   - Correct SHA256 checksums
   - Download URLs
5. **GoReleaser commits** the updated formula to `homebrew-venaqui` repository
6. **Users can install** with: `brew install mhrsntrk/venaqui/venaqui`

## Troubleshooting

### Token Permission Errors

If you see errors like "Resource not accessible by integration":
- Verify the token has `repo` scope
- Check that the token is correctly added to secrets
- Ensure the token has access to `homebrew-venaqui` repository

### Formula Not Updated

If the formula isn't being updated:
- Check GitHub Actions logs for errors
- Verify `HOMEBREW_GITHUB_API_TOKEN` secret exists
- Ensure `homebrew-venaqui` repository exists and is accessible
- Check that the formula file path matches: `Formula/venaqui.rb`

### First Release Issues

On the first release, GoReleaser will create the formula file. If it fails:
- Manually create `Formula/venaqui.rb` (can be empty or with placeholder content)
- Ensure the repository has at least one commit
- Try the release again

## Manual Update (If Needed)

If automation fails, you can manually update the formula:

1. Download the release tarball
2. Calculate SHA256: `shasum -a 256 venaqui_X.X.X_darwin_amd64.tar.gz`
3. Update `Formula/venaqui.rb` with new version and SHA256
4. Commit and push

But with automation set up, you shouldn't need to do this!

## Verification

After setup, test the installation:

```bash
# Tap your repository
brew tap mhrsntrk/venaqui

# Install
brew install venaqui

# Verify
venaqui version
```

## Next Steps

Once automation is working:
- ✅ Every release will automatically update Homebrew
- ✅ Users can install with: `brew install mhrsntrk/venaqui/venaqui`
- ✅ No manual formula updates needed!
